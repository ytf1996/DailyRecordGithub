#pragma checksum "C:\Users\16273\Desktop\MyNetCore\MyNetCore\Areas\Management\Views\ChatRoom\Detail.cshtml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "42969e621481318199722ba1cdc97268e41fa3d8"
// <auto-generated/>
#pragma warning disable 1591
[assembly: global::Microsoft.AspNetCore.Razor.Hosting.RazorCompiledItemAttribute(typeof(AspNetCore.Areas_Management_Views_ChatRoom_Detail), @"mvc.1.0.view", @"/Areas/Management/Views/ChatRoom/Detail.cshtml")]
namespace AspNetCore
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Mvc;
    using Microsoft.AspNetCore.Mvc.Rendering;
    using Microsoft.AspNetCore.Mvc.ViewFeatures;
#nullable restore
#line 1 "C:\Users\16273\Desktop\MyNetCore\MyNetCore\Areas\Management\Views\ChatRoom\Detail.cshtml"
using MyNetCore.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\16273\Desktop\MyNetCore\MyNetCore\Areas\Management\Views\ChatRoom\Detail.cshtml"
using MyNetCore.Business;

#line default
#line hidden
#nullable disable
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"42969e621481318199722ba1cdc97268e41fa3d8", @"/Areas/Management/Views/ChatRoom/Detail.cshtml")]
    public class Areas_Management_Views_ChatRoom_Detail : global::Microsoft.AspNetCore.Mvc.Razor.RazorPage<dynamic>
    {
        #pragma warning disable 1998
        public async override global::System.Threading.Tasks.Task ExecuteAsync()
        {
#nullable restore
#line 3 "C:\Users\16273\Desktop\MyNetCore\MyNetCore\Areas\Management\Views\ChatRoom\Detail.cshtml"
  
    var currentUser = new BusinessChatRoom().GetCurrentUserInfo();
    var currentUserCode = currentUser?.Code;
    string recordId = ViewBag.RecordId;
    var recordName = ViewBag.RecordName;
    var usersInRoom = MyNetCore.Business.Signal.SignalRHub.ChatRoomInfos.Where(m => m.RoomId == recordId);

#line default
#line hidden
#nullable disable
            WriteLiteral(@"
<style>
    .info {
        max-width: 85%;
        word-wrap: break-word;
    }

    #usersInfo {
        max-height: 545px;
        min-height: 545px;
        overflow: scroll;
    }

    .userLi {
        line-height: 40px;
        list-style: none;
    }

    .text-overflow {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
</style>

<div class=""row"">
    <div class=""col-md-6"">
        <div class=""card"">
            <h3 class=""card-title"">");
#nullable restore
#line 38 "C:\Users\16273\Desktop\MyNetCore\MyNetCore\Areas\Management\Views\ChatRoom\Detail.cshtml"
                              Write(recordName);

#line default
#line hidden
#nullable disable
            WriteLiteral(@"</h3>
            <div class=""messanger"">
                <div id=""messages"" class=""messages"">
                </div>
                <div class=""sender"">
                    <input type=""text"" id=""messageInput"" placeholder=""Send Message"" onkeydown=""onTextareaKeyDown()"">
                    <button id=""sendButton"" value=""Send"" class=""btn btn-primary"" type=""button""><i class=""fa fa-lg fa-fw fa-paper-plane""></i></button>
                </div>
            </div>
        </div>
    </div>
    <div class=""col-md-2"">
        <div id=""usersInfo"" class=""card"">
            <ul id=""userList"">
");
#nullable restore
#line 52 "C:\Users\16273\Desktop\MyNetCore\MyNetCore\Areas\Management\Views\ChatRoom\Detail.cshtml"
                  
                    foreach (var item in usersInRoom)
                    {

#line default
#line hidden
#nullable disable
            WriteLiteral("                        <li");
            BeginWriteAttribute("id", " id=\"", 1625, "\"", 1646, 1);
#nullable restore
#line 55 "C:\Users\16273\Desktop\MyNetCore\MyNetCore\Areas\Management\Views\ChatRoom\Detail.cshtml"
WriteAttributeValue("", 1630, item.UserCode, 1630, 16, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(" class=\"userLi text-overflow\"><img class=\"headimg img-circle\"");
            BeginWriteAttribute("src", " src=\"", 1708, "\"", 1733, 1);
#nullable restore
#line 55 "C:\Users\16273\Desktop\MyNetCore\MyNetCore\Areas\Management\Views\ChatRoom\Detail.cshtml"
WriteAttributeValue("", 1714, item.UserHeadImg, 1714, 19, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(" />&nbsp;&nbsp;");
#nullable restore
#line 55 "C:\Users\16273\Desktop\MyNetCore\MyNetCore\Areas\Management\Views\ChatRoom\Detail.cshtml"
                                                                                                                                                   Write(item.UserName);

#line default
#line hidden
#nullable disable
            WriteLiteral("</li>\r\n");
#nullable restore
#line 56 "C:\Users\16273\Desktop\MyNetCore\MyNetCore\Areas\Management\Views\ChatRoom\Detail.cshtml"
                    }
                

#line default
#line hidden
#nullable disable
            WriteLiteral(@"            </ul>
        </div>
    </div>
</div>

<script type=""text/javascript"" src=""/Content/js/plugins/signalr/signalr.js""></script>

<script>
    //发送文本框按下键盘事件
    function onTextareaKeyDown() {
        if (event.keyCode == 13) { //如果按的是enter键 13是enter
            event.preventDefault(); //禁止默认事件（默认是换行）
            $(""#sendButton"").click(); //执行发送动作
        }
    }

    var connection = new signalR.HubConnectionBuilder().withUrl(""/chatHub"").build();

        var recordId = """);
#nullable restore
#line 76 "C:\Users\16273\Desktop\MyNetCore\MyNetCore\Areas\Management\Views\ChatRoom\Detail.cshtml"
                   Write(recordId);

#line default
#line hidden
#nullable disable
            WriteLiteral("\";\r\n        var currentUserCode = \"");
#nullable restore
#line 77 "C:\Users\16273\Desktop\MyNetCore\MyNetCore\Areas\Management\Views\ChatRoom\Detail.cshtml"
                          Write(currentUserCode);

#line default
#line hidden
#nullable disable
            WriteLiteral(@""";

        //这个可以不一致
        connection.on(""toall_"" + recordId, function (userName, userCode, headImage, message, type) {
            if (type == ""userSpeak"") {
                if (currentUserCode == userCode) {
                    $(""#messages"").append('<div class=""message me""><img class=""headimg"" src = ""' + headImage + '"" ><p class=""info"">' + userName + ""：<br/>"" + message + '</p></div>');
                } else {
                    $(""#messages"").append('<div class=""message""><img class=""headimg"" src = ""' + headImage + '"" ><p class=""info"">' + userName + ""：<br/>"" + message + '</p></div>');
                }
                var showContent = $(""#messages"");
                showContent[0].scrollTop = showContent[0].scrollHeight;
            } else if (type == ""userCome"") {
                var obj = JSON.parse(message);
                if (obj && obj.UserCode) {
                    $(""#userList"").append(""<li id="" + obj.UserCode + "" class='userLi text-overflow'>"" + ""<img class='headimg img-circle");
            WriteLiteral(@"' src='"" + obj.UserHeadImg + ""'/>&nbsp;&nbsp;"" + obj.UserName + ""</li>"");
                }
            } else if (type == ""userGo"") {
                $(""#"" + message).remove();
            }
        });

    connection.start().then(function () {
        //和服务器必须一致
        connection.invoke(""sendall"", currentUserCode, recordId, ""userCome"").catch(function (err) {
            return console.info(err.toString());
        });

        }).catch(function (err) {
            return console.info(err.toString());
        });

        document.getElementById(""sendButton"").addEventListener(""click"", function (event) {
            var message = $(""#messageInput"").val();
            if (message == """") {
                $(""#sendButton"").attr(""disabled"", ""disabled"");
                return;
            }

            //和服务器必须一致
            connection.invoke(""sendall"", message, recordId,""userSpeak"").catch(function (err) {
                return console.info(err.toString());
            });
        ");
            WriteLiteral(@"    event.preventDefault();
            $(""#messageInput"").val("""");
            $(""#sendButton"").attr(""disabled"", ""disabled"");
        });

        $(""#sendButton"").attr(""disabled"", ""disabled"");

        //检验需要验证的控件验证都通过
        $(""#messageInput"").bind('input propertychange change', function () {
            if ($(""#messageInput"").val() == """") {
                $(""#sendButton"").attr(""disabled"", ""disabled"");
            } else {
                $(""#sendButton"").removeAttr(""disabled"");
            }
        });


    var _isIOS = -1;
    var _isAndroid = -1;
    const ua = window.navigator.userAgent.toLocaleLowerCase();

    function isIOS() {
        if (_isIOS === -1) {
            _isIOS = /iPhone|iPod|iPad/i.test(ua) ? 1 : 0;
        }
        return _isIOS === 1;
    }

    function isAndroid() {
        if (_isAndroid === -1) {
            _isAndroid = /Android/i.test(ua) ? 1 : 0;
        }
        return _isAndroid === 1;
    }
    if (isAndroid()) {
        const inner");
            WriteLiteral(@"Height = window.innerHeight;
        window.addEventListener('resize', () => {
            const newInnerHeight = window.innerHeight;
            if (innerHeight > newInnerHeight) {
                
            } else {
                // 键盘收起事件处理
                setTimeout(() => {
                    window.scrollTo(0, 0);
                }, 100);
            }
        });
    } else if (isIOS()) {
        window.addEventListener('focusin', () => {// 键盘弹出事件处理
        });
        window.addEventListener('focusout', () => { // 键盘收起事件处理
            
            window.scroll(0, 0)
        });
    }



</script>");
        }
        #pragma warning restore 1998
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.ViewFeatures.IModelExpressionProvider ModelExpressionProvider { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IUrlHelper Url { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IViewComponentHelper Component { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IJsonHelper Json { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IHtmlHelper<dynamic> Html { get; private set; }
    }
}
#pragma warning restore 1591
